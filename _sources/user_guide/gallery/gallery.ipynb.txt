{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Time domain averages (wide)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Read and check the epochs"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/turbach/miniconda3/envs/mckonda_spudtr_dev/lib/python3.6/site-packages/pyarrow/pandas_compat.py:752: FutureWarning: .labels was deprecated in version 0.24.0. Use .codes instead.\n",
      "  labels, = index.labels\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>sub_id</th>\n",
       "      <th>eeg_artifact</th>\n",
       "      <th>dblock_path</th>\n",
       "      <th>log_evcodes</th>\n",
       "      <th>log_ccodes</th>\n",
       "      <th>dblock_srate</th>\n",
       "      <th>ccode</th>\n",
       "      <th>instrument</th>\n",
       "      <th>...</th>\n",
       "      <th>RMOc</th>\n",
       "      <th>LLTe</th>\n",
       "      <th>RLTe</th>\n",
       "      <th>LLOc</th>\n",
       "      <th>RLOc</th>\n",
       "      <th>MiOc</th>\n",
       "      <th>A2</th>\n",
       "      <th>HEOG</th>\n",
       "      <th>rle</th>\n",
       "      <th>rhz</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>-748</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-25.093750</td>\n",
       "      <td>-0.753906</td>\n",
       "      <td>1.480469</td>\n",
       "      <td>-13.414062</td>\n",
       "      <td>-18.937500</td>\n",
       "      <td>-17.734375</td>\n",
       "      <td>5.660156</td>\n",
       "      <td>98.875000</td>\n",
       "      <td>-39.500000</td>\n",
       "      <td>38.375000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>-744</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-24.593750</td>\n",
       "      <td>0.502441</td>\n",
       "      <td>-2.466797</td>\n",
       "      <td>-17.640625</td>\n",
       "      <td>-17.468750</td>\n",
       "      <td>-15.304688</td>\n",
       "      <td>1.968750</td>\n",
       "      <td>104.750000</td>\n",
       "      <td>-38.031250</td>\n",
       "      <td>41.281250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>-740</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-16.484375</td>\n",
       "      <td>-1.507812</td>\n",
       "      <td>3.947266</td>\n",
       "      <td>-15.648438</td>\n",
       "      <td>-10.085938</td>\n",
       "      <td>-11.171875</td>\n",
       "      <td>8.367188</td>\n",
       "      <td>102.062500</td>\n",
       "      <td>-33.656250</td>\n",
       "      <td>43.718750</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>-736</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-11.804688</td>\n",
       "      <td>-15.070312</td>\n",
       "      <td>9.867188</td>\n",
       "      <td>-14.906250</td>\n",
       "      <td>-7.378906</td>\n",
       "      <td>-8.742188</td>\n",
       "      <td>9.351562</td>\n",
       "      <td>100.562500</td>\n",
       "      <td>-42.906250</td>\n",
       "      <td>37.406250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>-732</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-6.394531</td>\n",
       "      <td>-4.019531</td>\n",
       "      <td>9.125000</td>\n",
       "      <td>-10.679688</td>\n",
       "      <td>-6.886719</td>\n",
       "      <td>-8.015625</td>\n",
       "      <td>8.125000</td>\n",
       "      <td>98.375000</td>\n",
       "      <td>-43.875000</td>\n",
       "      <td>37.906250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>224995</th>\n",
       "      <td>600</td>\n",
       "      <td>732</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>0</td>\n",
       "      <td>cal</td>\n",
       "      <td>...</td>\n",
       "      <td>-4.671875</td>\n",
       "      <td>-3.517578</td>\n",
       "      <td>-4.441406</td>\n",
       "      <td>-4.718750</td>\n",
       "      <td>-4.671875</td>\n",
       "      <td>-3.400391</td>\n",
       "      <td>-4.429688</td>\n",
       "      <td>-4.406250</td>\n",
       "      <td>-3.900391</td>\n",
       "      <td>-4.371094</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>224996</th>\n",
       "      <td>600</td>\n",
       "      <td>736</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>0</td>\n",
       "      <td>cal</td>\n",
       "      <td>...</td>\n",
       "      <td>-4.179688</td>\n",
       "      <td>-4.019531</td>\n",
       "      <td>-4.195312</td>\n",
       "      <td>-4.222656</td>\n",
       "      <td>-4.425781</td>\n",
       "      <td>-3.644531</td>\n",
       "      <td>-4.429688</td>\n",
       "      <td>-4.160156</td>\n",
       "      <td>-3.412109</td>\n",
       "      <td>-4.371094</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>224997</th>\n",
       "      <td>600</td>\n",
       "      <td>740</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>0</td>\n",
       "      <td>cal</td>\n",
       "      <td>...</td>\n",
       "      <td>-4.425781</td>\n",
       "      <td>-3.767578</td>\n",
       "      <td>-4.441406</td>\n",
       "      <td>-3.974609</td>\n",
       "      <td>-4.425781</td>\n",
       "      <td>-3.400391</td>\n",
       "      <td>-4.429688</td>\n",
       "      <td>-4.160156</td>\n",
       "      <td>-3.900391</td>\n",
       "      <td>-4.859375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>224998</th>\n",
       "      <td>600</td>\n",
       "      <td>744</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>0</td>\n",
       "      <td>cal</td>\n",
       "      <td>...</td>\n",
       "      <td>-4.425781</td>\n",
       "      <td>-4.269531</td>\n",
       "      <td>-4.195312</td>\n",
       "      <td>-4.222656</td>\n",
       "      <td>-4.425781</td>\n",
       "      <td>-3.886719</td>\n",
       "      <td>-4.429688</td>\n",
       "      <td>-4.406250</td>\n",
       "      <td>-3.900391</td>\n",
       "      <td>-4.371094</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>224999</th>\n",
       "      <td>600</td>\n",
       "      <td>748</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>0</td>\n",
       "      <td>cal</td>\n",
       "      <td>...</td>\n",
       "      <td>-4.179688</td>\n",
       "      <td>-4.019531</td>\n",
       "      <td>-3.947266</td>\n",
       "      <td>-4.222656</td>\n",
       "      <td>-4.179688</td>\n",
       "      <td>-3.400391</td>\n",
       "      <td>-4.183594</td>\n",
       "      <td>-4.406250</td>\n",
       "      <td>-3.412109</td>\n",
       "      <td>-4.371094</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>225000 rows × 47 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        epoch_id  time_ms  sub_id  eeg_artifact      dblock_path  log_evcodes  \\\n",
       "0              0     -748  sub000             0  sub000/dblock_0            0   \n",
       "1              0     -744  sub000             0  sub000/dblock_0            0   \n",
       "2              0     -740  sub000             0  sub000/dblock_0            0   \n",
       "3              0     -736  sub000             0  sub000/dblock_0            0   \n",
       "4              0     -732  sub000             0  sub000/dblock_0            0   \n",
       "...          ...      ...     ...           ...              ...          ...   \n",
       "224995       600      732  sub000             0  sub000/dblock_4            0   \n",
       "224996       600      736  sub000             0  sub000/dblock_4            0   \n",
       "224997       600      740  sub000             0  sub000/dblock_4            0   \n",
       "224998       600      744  sub000             0  sub000/dblock_4            0   \n",
       "224999       600      748  sub000             0  sub000/dblock_4            0   \n",
       "\n",
       "        log_ccodes  dblock_srate  ccode instrument  ...       RMOc       LLTe  \\\n",
       "0                0         250.0      1        eeg  ... -25.093750  -0.753906   \n",
       "1                0         250.0      1        eeg  ... -24.593750   0.502441   \n",
       "2                0         250.0      1        eeg  ... -16.484375  -1.507812   \n",
       "3                0         250.0      1        eeg  ... -11.804688 -15.070312   \n",
       "4                0         250.0      1        eeg  ...  -6.394531  -4.019531   \n",
       "...            ...           ...    ...        ...  ...        ...        ...   \n",
       "224995           0         250.0      0        cal  ...  -4.671875  -3.517578   \n",
       "224996           0         250.0      0        cal  ...  -4.179688  -4.019531   \n",
       "224997           0         250.0      0        cal  ...  -4.425781  -3.767578   \n",
       "224998           0         250.0      0        cal  ...  -4.425781  -4.269531   \n",
       "224999           0         250.0      0        cal  ...  -4.179688  -4.019531   \n",
       "\n",
       "            RLTe       LLOc       RLOc       MiOc        A2        HEOG  \\\n",
       "0       1.480469 -13.414062 -18.937500 -17.734375  5.660156   98.875000   \n",
       "1      -2.466797 -17.640625 -17.468750 -15.304688  1.968750  104.750000   \n",
       "2       3.947266 -15.648438 -10.085938 -11.171875  8.367188  102.062500   \n",
       "3       9.867188 -14.906250  -7.378906  -8.742188  9.351562  100.562500   \n",
       "4       9.125000 -10.679688  -6.886719  -8.015625  8.125000   98.375000   \n",
       "...          ...        ...        ...        ...       ...         ...   \n",
       "224995 -4.441406  -4.718750  -4.671875  -3.400391 -4.429688   -4.406250   \n",
       "224996 -4.195312  -4.222656  -4.425781  -3.644531 -4.429688   -4.160156   \n",
       "224997 -4.441406  -3.974609  -4.425781  -3.400391 -4.429688   -4.160156   \n",
       "224998 -4.195312  -4.222656  -4.425781  -3.886719 -4.429688   -4.406250   \n",
       "224999 -3.947266  -4.222656  -4.179688  -3.400391 -4.183594   -4.406250   \n",
       "\n",
       "              rle        rhz  \n",
       "0      -39.500000  38.375000  \n",
       "1      -38.031250  41.281250  \n",
       "2      -33.656250  43.718750  \n",
       "3      -42.906250  37.406250  \n",
       "4      -43.875000  37.906250  \n",
       "...           ...        ...  \n",
       "224995  -3.900391  -4.371094  \n",
       "224996  -3.412109  -4.371094  \n",
       "224997  -3.900391  -4.859375  \n",
       "224998  -3.900391  -4.371094  \n",
       "224999  -3.412109  -4.371094  \n",
       "\n",
       "[225000 rows x 47 columns]"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "from spudtr import epf\n",
    "from spudtr import get_demo_df, DATA_DIR, P3_1500_FEATHER\n",
    "\n",
    "epochs_df = get_demo_df(P3_1500_FEATHER)\n",
    "eeg_channels = ['MiPf', 'MiCe', 'MiPa', 'MiOc']\n",
    "\n",
    "epf.check_epochs(epochs_df, eeg_channels, epoch_id=\"epoch_id\", time=\"time_ms\")\n",
    "epochs_df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Group by `time` to compute the time-domain average of all epochs and select columns of interest"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>channel</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>time_ms</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>-748</th>\n",
       "      <td>-0.647500</td>\n",
       "      <td>-0.818429</td>\n",
       "      <td>-0.650280</td>\n",
       "      <td>-1.128954</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-744</th>\n",
       "      <td>-0.590833</td>\n",
       "      <td>-0.838763</td>\n",
       "      <td>-0.648749</td>\n",
       "      <td>-1.025912</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-740</th>\n",
       "      <td>-0.569167</td>\n",
       "      <td>-0.987738</td>\n",
       "      <td>-0.715166</td>\n",
       "      <td>-1.047582</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-736</th>\n",
       "      <td>-0.600000</td>\n",
       "      <td>-1.013976</td>\n",
       "      <td>-0.672859</td>\n",
       "      <td>-0.980162</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>-732</th>\n",
       "      <td>-0.767500</td>\n",
       "      <td>-1.069512</td>\n",
       "      <td>-0.705796</td>\n",
       "      <td>-0.867579</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>732</th>\n",
       "      <td>1.345833</td>\n",
       "      <td>-0.855422</td>\n",
       "      <td>-1.573245</td>\n",
       "      <td>-1.943028</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>736</th>\n",
       "      <td>1.138333</td>\n",
       "      <td>-0.999023</td>\n",
       "      <td>-1.762801</td>\n",
       "      <td>-2.063682</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>740</th>\n",
       "      <td>0.985000</td>\n",
       "      <td>-1.031177</td>\n",
       "      <td>-1.794903</td>\n",
       "      <td>-2.081421</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>744</th>\n",
       "      <td>0.877500</td>\n",
       "      <td>-1.011374</td>\n",
       "      <td>-1.770285</td>\n",
       "      <td>-2.010948</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>748</th>\n",
       "      <td>0.866667</td>\n",
       "      <td>-0.863825</td>\n",
       "      <td>-1.608073</td>\n",
       "      <td>-1.863831</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>375 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "channel      MiPf      MiCe      MiPa      MiOc\n",
       "time_ms                                        \n",
       "-748    -0.647500 -0.818429 -0.650280 -1.128954\n",
       "-744    -0.590833 -0.838763 -0.648749 -1.025912\n",
       "-740    -0.569167 -0.987738 -0.715166 -1.047582\n",
       "-736    -0.600000 -1.013976 -0.672859 -0.980162\n",
       "-732    -0.767500 -1.069512 -0.705796 -0.867579\n",
       "...           ...       ...       ...       ...\n",
       " 732     1.345833 -0.855422 -1.573245 -1.943028\n",
       " 736     1.138333 -0.999023 -1.762801 -2.063682\n",
       " 740     0.985000 -1.031177 -1.794903 -2.081421\n",
       " 744     0.877500 -1.011374 -1.770285 -2.010948\n",
       " 748     0.866667 -0.863825 -1.608073 -1.863831\n",
       "\n",
       "[375 rows x 4 columns]"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "grand_wide = epochs_df.groupby(['time_ms']).mean()[eeg_channels]\n",
    "grand_wide.columns.name = 'channel'\n",
    "grand_wide"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Group by `time` and other columns to compute the average of subsets of epochs"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>channel</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">-748</th>\n",
       "      <th>cal</th>\n",
       "      <td>-4.317307</td>\n",
       "      <td>-3.857553</td>\n",
       "      <td>-4.073911</td>\n",
       "      <td>-4.143690</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>standard</th>\n",
       "      <td>1.419520</td>\n",
       "      <td>0.651240</td>\n",
       "      <td>0.729152</td>\n",
       "      <td>0.773548</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target</th>\n",
       "      <td>0.950000</td>\n",
       "      <td>1.211514</td>\n",
       "      <td>2.442932</td>\n",
       "      <td>-0.413608</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"2\" valign=\"top\">-744</th>\n",
       "      <th>cal</th>\n",
       "      <td>-4.329327</td>\n",
       "      <td>-3.851473</td>\n",
       "      <td>-4.114043</td>\n",
       "      <td>-4.118098</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>standard</th>\n",
       "      <td>1.493151</td>\n",
       "      <td>0.686627</td>\n",
       "      <td>0.894989</td>\n",
       "      <td>1.060941</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"2\" valign=\"top\">744</th>\n",
       "      <th>standard</th>\n",
       "      <td>-1.669520</td>\n",
       "      <td>0.564905</td>\n",
       "      <td>-2.007408</td>\n",
       "      <td>-2.380829</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target</th>\n",
       "      <td>19.059999</td>\n",
       "      <td>0.232344</td>\n",
       "      <td>3.668494</td>\n",
       "      <td>3.395762</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">748</th>\n",
       "      <th>cal</th>\n",
       "      <td>-4.305288</td>\n",
       "      <td>-3.828247</td>\n",
       "      <td>-4.077405</td>\n",
       "      <td>-4.089811</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>standard</th>\n",
       "      <td>-1.566781</td>\n",
       "      <td>0.687771</td>\n",
       "      <td>-1.867695</td>\n",
       "      <td>-2.206024</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>target</th>\n",
       "      <td>18.730000</td>\n",
       "      <td>0.771514</td>\n",
       "      <td>4.286233</td>\n",
       "      <td>3.765410</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1125 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "channel                MiPf      MiCe      MiPa      MiOc\n",
       "time_ms stim                                             \n",
       "-748    cal       -4.317307 -3.857553 -4.073911 -4.143690\n",
       "        standard   1.419520  0.651240  0.729152  0.773548\n",
       "        target     0.950000  1.211514  2.442932 -0.413608\n",
       "-744    cal       -4.329327 -3.851473 -4.114043 -4.118098\n",
       "        standard   1.493151  0.686627  0.894989  1.060941\n",
       "...                     ...       ...       ...       ...\n",
       " 744    standard  -1.669520  0.564905 -2.007408 -2.380829\n",
       "        target    19.059999  0.232344  3.668494  3.395762\n",
       " 748    cal       -4.305288 -3.828247 -4.077405 -4.089811\n",
       "        standard  -1.566781  0.687771 -1.867695 -2.206024\n",
       "        target    18.730000  0.771514  4.286233  3.765410\n",
       "\n",
       "[1125 rows x 4 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "subsets_wide = epochs_df.groupby([\"time_ms\", \"stim\"]).mean()[eeg_channels]\n",
    "subsets_wide.columns.name = \"channel\"\n",
    "subsets_wide"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Time-domain averages (long)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>microvolts</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th>channel</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th rowspan=\"5\" valign=\"top\">-748</th>\n",
       "      <th rowspan=\"4\" valign=\"top\">cal</th>\n",
       "      <th>MiPf</th>\n",
       "      <td>-4.317307</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiCe</th>\n",
       "      <td>-3.857553</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiPa</th>\n",
       "      <td>-4.073911</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiOc</th>\n",
       "      <td>-4.143690</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>standard</th>\n",
       "      <th>MiPf</th>\n",
       "      <td>1.419520</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <th>...</th>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"5\" valign=\"top\">748</th>\n",
       "      <th>standard</th>\n",
       "      <th>MiOc</th>\n",
       "      <td>-2.206024</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">target</th>\n",
       "      <th>MiPf</th>\n",
       "      <td>18.730000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiCe</th>\n",
       "      <td>0.771514</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiPa</th>\n",
       "      <td>4.286233</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MiOc</th>\n",
       "      <td>3.765410</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>4500 rows × 1 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                          microvolts\n",
       "time_ms stim     channel            \n",
       "-748    cal      MiPf      -4.317307\n",
       "                 MiCe      -3.857553\n",
       "                 MiPa      -4.073911\n",
       "                 MiOc      -4.143690\n",
       "        standard MiPf       1.419520\n",
       "...                              ...\n",
       " 748    standard MiOc      -2.206024\n",
       "        target   MiPf      18.730000\n",
       "                 MiCe       0.771514\n",
       "                 MiPa       4.286233\n",
       "                 MiOc       3.765410\n",
       "\n",
       "[4500 rows x 1 columns]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "subsets_long = subsets_wide.stack()  # pivot the channel columns into one long column\n",
    "subsets_long.name = \"microvolts\"\n",
    "pd.DataFrame(subsets_long)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Time interval measurments\n",
    "\n",
    "Interval measurments use the \"slice-groupby-apply\" pattern.  \n",
    "\n",
    "* slice the time interval rows\n",
    "\n",
    "* group by epoch_id and other tags\n",
    "\n",
    "* apply the measurment function to the data, e.g., pandas built-in or user-defined\n",
    "\n",
    "\n",
    "Start by doing the steps separately to verify.\n",
    "\n",
    "When the steps are right, chain them for compact expression.\n",
    "\n",
    "Example: single trial mean amplitude"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "1. Load the epochs"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>sub_id</th>\n",
       "      <th>eeg_artifact</th>\n",
       "      <th>dblock_path</th>\n",
       "      <th>log_evcodes</th>\n",
       "      <th>log_ccodes</th>\n",
       "      <th>dblock_srate</th>\n",
       "      <th>ccode</th>\n",
       "      <th>instrument</th>\n",
       "      <th>...</th>\n",
       "      <th>RMOc</th>\n",
       "      <th>LLTe</th>\n",
       "      <th>RLTe</th>\n",
       "      <th>LLOc</th>\n",
       "      <th>RLOc</th>\n",
       "      <th>MiOc</th>\n",
       "      <th>A2</th>\n",
       "      <th>HEOG</th>\n",
       "      <th>rle</th>\n",
       "      <th>rhz</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>-748</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-25.093750</td>\n",
       "      <td>-0.753906</td>\n",
       "      <td>1.480469</td>\n",
       "      <td>-13.414062</td>\n",
       "      <td>-18.937500</td>\n",
       "      <td>-17.734375</td>\n",
       "      <td>5.660156</td>\n",
       "      <td>98.875000</td>\n",
       "      <td>-39.500000</td>\n",
       "      <td>38.375000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>-744</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-24.593750</td>\n",
       "      <td>0.502441</td>\n",
       "      <td>-2.466797</td>\n",
       "      <td>-17.640625</td>\n",
       "      <td>-17.468750</td>\n",
       "      <td>-15.304688</td>\n",
       "      <td>1.968750</td>\n",
       "      <td>104.750000</td>\n",
       "      <td>-38.031250</td>\n",
       "      <td>41.281250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>-740</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-16.484375</td>\n",
       "      <td>-1.507812</td>\n",
       "      <td>3.947266</td>\n",
       "      <td>-15.648438</td>\n",
       "      <td>-10.085938</td>\n",
       "      <td>-11.171875</td>\n",
       "      <td>8.367188</td>\n",
       "      <td>102.062500</td>\n",
       "      <td>-33.656250</td>\n",
       "      <td>43.718750</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>-736</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-11.804688</td>\n",
       "      <td>-15.070312</td>\n",
       "      <td>9.867188</td>\n",
       "      <td>-14.906250</td>\n",
       "      <td>-7.378906</td>\n",
       "      <td>-8.742188</td>\n",
       "      <td>9.351562</td>\n",
       "      <td>100.562500</td>\n",
       "      <td>-42.906250</td>\n",
       "      <td>37.406250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>-732</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>-6.394531</td>\n",
       "      <td>-4.019531</td>\n",
       "      <td>9.125000</td>\n",
       "      <td>-10.679688</td>\n",
       "      <td>-6.886719</td>\n",
       "      <td>-8.015625</td>\n",
       "      <td>8.125000</td>\n",
       "      <td>98.375000</td>\n",
       "      <td>-43.875000</td>\n",
       "      <td>37.906250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146995</th>\n",
       "      <td>391</td>\n",
       "      <td>732</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>9.593750</td>\n",
       "      <td>10.804688</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>4.472656</td>\n",
       "      <td>1.967773</td>\n",
       "      <td>4.617188</td>\n",
       "      <td>-3.937500</td>\n",
       "      <td>-9.296875</td>\n",
       "      <td>-10.242188</td>\n",
       "      <td>-2.429688</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146996</th>\n",
       "      <td>391</td>\n",
       "      <td>736</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>15.250000</td>\n",
       "      <td>15.578125</td>\n",
       "      <td>8.632812</td>\n",
       "      <td>10.429688</td>\n",
       "      <td>8.609375</td>\n",
       "      <td>10.929688</td>\n",
       "      <td>-0.246094</td>\n",
       "      <td>-7.343750</td>\n",
       "      <td>-7.800781</td>\n",
       "      <td>2.914062</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146997</th>\n",
       "      <td>391</td>\n",
       "      <td>740</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>11.070312</td>\n",
       "      <td>11.554688</td>\n",
       "      <td>4.195312</td>\n",
       "      <td>7.203125</td>\n",
       "      <td>6.886719</td>\n",
       "      <td>7.773438</td>\n",
       "      <td>-4.429688</td>\n",
       "      <td>-7.832031</td>\n",
       "      <td>-13.648438</td>\n",
       "      <td>-2.429688</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146998</th>\n",
       "      <td>391</td>\n",
       "      <td>744</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>13.039062</td>\n",
       "      <td>6.781250</td>\n",
       "      <td>6.414062</td>\n",
       "      <td>9.187500</td>\n",
       "      <td>10.578125</td>\n",
       "      <td>10.445312</td>\n",
       "      <td>0.246094</td>\n",
       "      <td>-8.320312</td>\n",
       "      <td>-8.773438</td>\n",
       "      <td>-1.457031</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146999</th>\n",
       "      <td>391</td>\n",
       "      <td>748</td>\n",
       "      <td>sub000</td>\n",
       "      <td>0</td>\n",
       "      <td>sub000/dblock_3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>1</td>\n",
       "      <td>eeg</td>\n",
       "      <td>...</td>\n",
       "      <td>13.531250</td>\n",
       "      <td>8.539062</td>\n",
       "      <td>10.359375</td>\n",
       "      <td>11.671875</td>\n",
       "      <td>13.531250</td>\n",
       "      <td>11.906250</td>\n",
       "      <td>3.937500</td>\n",
       "      <td>-8.320312</td>\n",
       "      <td>-10.242188</td>\n",
       "      <td>0.485840</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>147000 rows × 47 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        epoch_id  time_ms  sub_id  eeg_artifact      dblock_path  log_evcodes  \\\n",
       "0              0     -748  sub000             0  sub000/dblock_0            0   \n",
       "1              0     -744  sub000             0  sub000/dblock_0            0   \n",
       "2              0     -740  sub000             0  sub000/dblock_0            0   \n",
       "3              0     -736  sub000             0  sub000/dblock_0            0   \n",
       "4              0     -732  sub000             0  sub000/dblock_0            0   \n",
       "...          ...      ...     ...           ...              ...          ...   \n",
       "146995       391      732  sub000             0  sub000/dblock_3            0   \n",
       "146996       391      736  sub000             0  sub000/dblock_3            0   \n",
       "146997       391      740  sub000             0  sub000/dblock_3            0   \n",
       "146998       391      744  sub000             0  sub000/dblock_3            0   \n",
       "146999       391      748  sub000             0  sub000/dblock_3            0   \n",
       "\n",
       "        log_ccodes  dblock_srate  ccode instrument  ...       RMOc       LLTe  \\\n",
       "0                0         250.0      1        eeg  ... -25.093750  -0.753906   \n",
       "1                0         250.0      1        eeg  ... -24.593750   0.502441   \n",
       "2                0         250.0      1        eeg  ... -16.484375  -1.507812   \n",
       "3                0         250.0      1        eeg  ... -11.804688 -15.070312   \n",
       "4                0         250.0      1        eeg  ...  -6.394531  -4.019531   \n",
       "...            ...           ...    ...        ...  ...        ...        ...   \n",
       "146995           0         250.0      1        eeg  ...   9.593750  10.804688   \n",
       "146996           0         250.0      1        eeg  ...  15.250000  15.578125   \n",
       "146997           0         250.0      1        eeg  ...  11.070312  11.554688   \n",
       "146998           0         250.0      1        eeg  ...  13.039062   6.781250   \n",
       "146999           0         250.0      1        eeg  ...  13.531250   8.539062   \n",
       "\n",
       "             RLTe       LLOc       RLOc       MiOc        A2        HEOG  \\\n",
       "0        1.480469 -13.414062 -18.937500 -17.734375  5.660156   98.875000   \n",
       "1       -2.466797 -17.640625 -17.468750 -15.304688  1.968750  104.750000   \n",
       "2        3.947266 -15.648438 -10.085938 -11.171875  8.367188  102.062500   \n",
       "3        9.867188 -14.906250  -7.378906  -8.742188  9.351562  100.562500   \n",
       "4        9.125000 -10.679688  -6.886719  -8.015625  8.125000   98.375000   \n",
       "...           ...        ...        ...        ...       ...         ...   \n",
       "146995   0.000000   4.472656   1.967773   4.617188 -3.937500   -9.296875   \n",
       "146996   8.632812  10.429688   8.609375  10.929688 -0.246094   -7.343750   \n",
       "146997   4.195312   7.203125   6.886719   7.773438 -4.429688   -7.832031   \n",
       "146998   6.414062   9.187500  10.578125  10.445312  0.246094   -8.320312   \n",
       "146999  10.359375  11.671875  13.531250  11.906250  3.937500   -8.320312   \n",
       "\n",
       "              rle        rhz  \n",
       "0      -39.500000  38.375000  \n",
       "1      -38.031250  41.281250  \n",
       "2      -33.656250  43.718750  \n",
       "3      -42.906250  37.406250  \n",
       "4      -43.875000  37.906250  \n",
       "...           ...        ...  \n",
       "146995 -10.242188  -2.429688  \n",
       "146996  -7.800781   2.914062  \n",
       "146997 -13.648438  -2.429688  \n",
       "146998  -8.773438  -1.457031  \n",
       "146999 -10.242188   0.485840  \n",
       "\n",
       "[147000 rows x 47 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "eeg_channels = [\"MiPf\", \"MiCe\", \"MiPa\", \"MiOc\"]\n",
    "\n",
    "epochs_df = get_demo_df(P3_1500_FEATHER).query('stim in [\"target\", \"standard\"]')\n",
    "epf.check_epochs(epochs_df, eeg_channels, epoch_id=\"epoch_id\", time=\"time_ms\")\n",
    "epochs_df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "2. (optional) select the data columns of interest or skip this and use them all."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>-748</td>\n",
       "      <td>target</td>\n",
       "      <td>-54.5</td>\n",
       "      <td>2.781250</td>\n",
       "      <td>-8.828125</td>\n",
       "      <td>-17.734375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>-744</td>\n",
       "      <td>target</td>\n",
       "      <td>-56.5</td>\n",
       "      <td>-4.046875</td>\n",
       "      <td>-11.929688</td>\n",
       "      <td>-15.304688</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>-740</td>\n",
       "      <td>target</td>\n",
       "      <td>-55.5</td>\n",
       "      <td>-3.289062</td>\n",
       "      <td>-4.769531</td>\n",
       "      <td>-11.171875</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>-736</td>\n",
       "      <td>target</td>\n",
       "      <td>-60.5</td>\n",
       "      <td>-2.529297</td>\n",
       "      <td>0.954102</td>\n",
       "      <td>-8.742188</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>-732</td>\n",
       "      <td>target</td>\n",
       "      <td>-57.0</td>\n",
       "      <td>4.046875</td>\n",
       "      <td>9.781250</td>\n",
       "      <td>-8.015625</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   epoch_id  time_ms    stim  MiPf      MiCe       MiPa       MiOc\n",
       "0         0     -748  target -54.5  2.781250  -8.828125 -17.734375\n",
       "1         0     -744  target -56.5 -4.046875 -11.929688 -15.304688\n",
       "2         0     -740  target -55.5 -3.289062  -4.769531 -11.171875\n",
       "3         0     -736  target -60.5 -2.529297   0.954102  -8.742188\n",
       "4         0     -732  target -57.0  4.046875   9.781250  -8.015625"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>146995</th>\n",
       "      <td>391</td>\n",
       "      <td>732</td>\n",
       "      <td>standard</td>\n",
       "      <td>9.5</td>\n",
       "      <td>3.289062</td>\n",
       "      <td>15.265625</td>\n",
       "      <td>4.617188</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146996</th>\n",
       "      <td>391</td>\n",
       "      <td>736</td>\n",
       "      <td>standard</td>\n",
       "      <td>15.5</td>\n",
       "      <td>9.359375</td>\n",
       "      <td>21.234375</td>\n",
       "      <td>10.929688</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146997</th>\n",
       "      <td>391</td>\n",
       "      <td>740</td>\n",
       "      <td>standard</td>\n",
       "      <td>9.0</td>\n",
       "      <td>3.792969</td>\n",
       "      <td>15.507812</td>\n",
       "      <td>7.773438</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146998</th>\n",
       "      <td>391</td>\n",
       "      <td>744</td>\n",
       "      <td>standard</td>\n",
       "      <td>7.5</td>\n",
       "      <td>4.300781</td>\n",
       "      <td>15.507812</td>\n",
       "      <td>10.445312</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146999</th>\n",
       "      <td>391</td>\n",
       "      <td>748</td>\n",
       "      <td>standard</td>\n",
       "      <td>6.0</td>\n",
       "      <td>4.554688</td>\n",
       "      <td>14.789062</td>\n",
       "      <td>11.906250</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        epoch_id  time_ms      stim  MiPf      MiCe       MiPa       MiOc\n",
       "146995       391      732  standard   9.5  3.289062  15.265625   4.617188\n",
       "146996       391      736  standard  15.5  9.359375  21.234375  10.929688\n",
       "146997       391      740  standard   9.0  3.792969  15.507812   7.773438\n",
       "146998       391      744  standard   7.5  4.300781  15.507812  10.445312\n",
       "146999       391      748  standard   6.0  4.554688  14.789062  11.906250"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "coi = [\"epoch_id\", \"time_ms\", \"stim\", \"MiPf\", \"MiCe\", \"MiPa\", \"MiOc\"]\n",
    "mid = epochs_df[coi]  # select columns of interest\n",
    "\n",
    "display(mid.head())\n",
    "display(mid.tail())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "3. Slice the time interval data sample (rows) to measure and verify by inspection"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>262</th>\n",
       "      <td>0</td>\n",
       "      <td>300</td>\n",
       "      <td>target</td>\n",
       "      <td>-46.0</td>\n",
       "      <td>69.5625</td>\n",
       "      <td>77.5000</td>\n",
       "      <td>29.640625</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>263</th>\n",
       "      <td>0</td>\n",
       "      <td>304</td>\n",
       "      <td>target</td>\n",
       "      <td>-41.5</td>\n",
       "      <td>78.4375</td>\n",
       "      <td>82.7500</td>\n",
       "      <td>33.531250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>264</th>\n",
       "      <td>0</td>\n",
       "      <td>308</td>\n",
       "      <td>target</td>\n",
       "      <td>-39.0</td>\n",
       "      <td>83.1875</td>\n",
       "      <td>84.4375</td>\n",
       "      <td>33.031250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>265</th>\n",
       "      <td>0</td>\n",
       "      <td>312</td>\n",
       "      <td>target</td>\n",
       "      <td>-39.5</td>\n",
       "      <td>81.9375</td>\n",
       "      <td>82.3125</td>\n",
       "      <td>29.875000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>266</th>\n",
       "      <td>0</td>\n",
       "      <td>316</td>\n",
       "      <td>target</td>\n",
       "      <td>-36.5</td>\n",
       "      <td>82.6875</td>\n",
       "      <td>83.2500</td>\n",
       "      <td>31.828125</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     epoch_id  time_ms    stim  MiPf     MiCe     MiPa       MiOc\n",
       "262         0      300  target -46.0  69.5625  77.5000  29.640625\n",
       "263         0      304  target -41.5  78.4375  82.7500  33.531250\n",
       "264         0      308  target -39.0  83.1875  84.4375  33.031250\n",
       "265         0      312  target -39.5  81.9375  82.3125  29.875000\n",
       "266         0      316  target -36.5  82.6875  83.2500  31.828125"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>epoch_id</th>\n",
       "      <th>time_ms</th>\n",
       "      <th>stim</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>146933</th>\n",
       "      <td>391</td>\n",
       "      <td>484</td>\n",
       "      <td>standard</td>\n",
       "      <td>14.5</td>\n",
       "      <td>3.541016</td>\n",
       "      <td>5.726562</td>\n",
       "      <td>5.585938</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146934</th>\n",
       "      <td>391</td>\n",
       "      <td>488</td>\n",
       "      <td>standard</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-4.300781</td>\n",
       "      <td>-5.484375</td>\n",
       "      <td>-1.943359</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146935</th>\n",
       "      <td>391</td>\n",
       "      <td>492</td>\n",
       "      <td>standard</td>\n",
       "      <td>8.5</td>\n",
       "      <td>-6.578125</td>\n",
       "      <td>-10.015625</td>\n",
       "      <td>-1.214844</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146936</th>\n",
       "      <td>391</td>\n",
       "      <td>496</td>\n",
       "      <td>standard</td>\n",
       "      <td>6.5</td>\n",
       "      <td>-11.382812</td>\n",
       "      <td>-14.789062</td>\n",
       "      <td>-0.971680</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146937</th>\n",
       "      <td>391</td>\n",
       "      <td>500</td>\n",
       "      <td>standard</td>\n",
       "      <td>-1.5</td>\n",
       "      <td>-21.250000</td>\n",
       "      <td>-21.937500</td>\n",
       "      <td>-2.429688</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        epoch_id  time_ms      stim  MiPf       MiCe       MiPa      MiOc\n",
       "146933       391      484  standard  14.5   3.541016   5.726562  5.585938\n",
       "146934       391      488  standard  13.0  -4.300781  -5.484375 -1.943359\n",
       "146935       391      492  standard   8.5  -6.578125 -10.015625 -1.214844\n",
       "146936       391      496  standard   6.5 -11.382812 -14.789062 -0.971680\n",
       "146937       391      500  standard  -1.5 -21.250000 -21.937500 -2.429688"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "300"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "500"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "mid_300_500 = mid.query(\"time_ms >= 300 and time_ms <= 500\")\n",
    "\n",
    "display(mid_300_500.head())\n",
    "display(mid_300_500.tail())\n",
    "display(mid_300_500[\"time_ms\"].min(), mid_300_500[\"time_ms\"].max())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "4. **Group by** epoch_id, i.e., single trial, and other column labels to preserve them, and **apply** the built-in `mean()` function.\n",
    "\n",
    "**Note** the `time_ms` timestamps is just another column of data and also averaged in the interval.\n",
    "  \n",
    "**Note** `pandas.Dataframe` has dozens of [built-in stats functions](https://pandas.pydata.org/pandas-docs/stable/reference/frame.html?highlight=dataframe%20methods#computations-descriptive-stats) besides mean: `max()`, `min()`, `std()`, `var()`, ...\n",
    "  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>time_ms</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>epoch_id</th>\n",
       "      <th>stim</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <th>target</th>\n",
       "      <td>400</td>\n",
       "      <td>-42.176472</td>\n",
       "      <td>42.853859</td>\n",
       "      <td>52.521751</td>\n",
       "      <td>12.860375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <th>target</th>\n",
       "      <td>400</td>\n",
       "      <td>-14.617647</td>\n",
       "      <td>41.024815</td>\n",
       "      <td>42.625919</td>\n",
       "      <td>6.120811</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <th>target</th>\n",
       "      <td>400</td>\n",
       "      <td>-7.186275</td>\n",
       "      <td>24.073071</td>\n",
       "      <td>31.395679</td>\n",
       "      <td>13.836741</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <th>target</th>\n",
       "      <td>400</td>\n",
       "      <td>-16.911764</td>\n",
       "      <td>20.560892</td>\n",
       "      <td>26.349571</td>\n",
       "      <td>16.461147</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <th>target</th>\n",
       "      <td>400</td>\n",
       "      <td>13.039216</td>\n",
       "      <td>27.078394</td>\n",
       "      <td>22.416552</td>\n",
       "      <td>5.758588</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                 time_ms       MiPf       MiCe       MiPa       MiOc\n",
       "epoch_id stim                                                       \n",
       "0        target      400 -42.176472  42.853859  52.521751  12.860375\n",
       "1        target      400 -14.617647  41.024815  42.625919   6.120811\n",
       "2        target      400  -7.186275  24.073071  31.395679  13.836741\n",
       "3        target      400 -16.911764  20.560892  26.349571  16.461147\n",
       "4        target      400  13.039216  27.078394  22.416552   5.758588"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>time_ms</th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>epoch_id</th>\n",
       "      <th>stim</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>387</th>\n",
       "      <th>standard</th>\n",
       "      <td>400</td>\n",
       "      <td>13.911765</td>\n",
       "      <td>20.714920</td>\n",
       "      <td>22.612095</td>\n",
       "      <td>4.010857</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>388</th>\n",
       "      <th>standard</th>\n",
       "      <td>400</td>\n",
       "      <td>24.696079</td>\n",
       "      <td>-4.259727</td>\n",
       "      <td>0.098336</td>\n",
       "      <td>-2.500594</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>389</th>\n",
       "      <th>standard</th>\n",
       "      <td>400</td>\n",
       "      <td>27.578432</td>\n",
       "      <td>11.336646</td>\n",
       "      <td>14.499387</td>\n",
       "      <td>6.349677</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>390</th>\n",
       "      <th>standard</th>\n",
       "      <td>400</td>\n",
       "      <td>36.323528</td>\n",
       "      <td>-0.446557</td>\n",
       "      <td>3.442656</td>\n",
       "      <td>-0.209578</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>391</th>\n",
       "      <th>standard</th>\n",
       "      <td>400</td>\n",
       "      <td>11.490196</td>\n",
       "      <td>-12.447074</td>\n",
       "      <td>-6.483092</td>\n",
       "      <td>-2.429051</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   time_ms       MiPf       MiCe       MiPa      MiOc\n",
       "epoch_id stim                                                        \n",
       "387      standard      400  13.911765  20.714920  22.612095  4.010857\n",
       "388      standard      400  24.696079  -4.259727   0.098336 -2.500594\n",
       "389      standard      400  27.578432  11.336646  14.499387  6.349677\n",
       "390      standard      400  36.323528  -0.446557   3.442656 -0.209578\n",
       "391      standard      400  11.490196 -12.447074  -6.483092 -2.429051"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "mid_300_500_mna = mid_300_500.groupby([\"epoch_id\", \"stim\"]).mean()\n",
    "\n",
    "display(mid_300_500_mna.head(), mid_300_500_mna.tail())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "5. The epoch interval measurements are new data, re-label them appropriately."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "      <th>measure</th>\n",
       "      <th>interval</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>epoch_id</th>\n",
       "      <th>stim</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <th>target</th>\n",
       "      <td>-42.176472</td>\n",
       "      <td>42.853859</td>\n",
       "      <td>52.521751</td>\n",
       "      <td>12.860375</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <th>target</th>\n",
       "      <td>-14.617647</td>\n",
       "      <td>41.024815</td>\n",
       "      <td>42.625919</td>\n",
       "      <td>6.120811</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <th>target</th>\n",
       "      <td>-7.186275</td>\n",
       "      <td>24.073071</td>\n",
       "      <td>31.395679</td>\n",
       "      <td>13.836741</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <th>target</th>\n",
       "      <td>-16.911764</td>\n",
       "      <td>20.560892</td>\n",
       "      <td>26.349571</td>\n",
       "      <td>16.461147</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <th>target</th>\n",
       "      <td>13.039216</td>\n",
       "      <td>27.078394</td>\n",
       "      <td>22.416552</td>\n",
       "      <td>5.758588</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                      MiPf       MiCe       MiPa       MiOc measure interval\n",
       "epoch_id stim                                                               \n",
       "0        target -42.176472  42.853859  52.521751  12.860375     mna  300_500\n",
       "1        target -14.617647  41.024815  42.625919   6.120811     mna  300_500\n",
       "2        target  -7.186275  24.073071  31.395679  13.836741     mna  300_500\n",
       "3        target -16.911764  20.560892  26.349571  16.461147     mna  300_500\n",
       "4        target  13.039216  27.078394  22.416552   5.758588     mna  300_500"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>MiPf</th>\n",
       "      <th>MiCe</th>\n",
       "      <th>MiPa</th>\n",
       "      <th>MiOc</th>\n",
       "      <th>measure</th>\n",
       "      <th>interval</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>epoch_id</th>\n",
       "      <th>stim</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>387</th>\n",
       "      <th>standard</th>\n",
       "      <td>13.911765</td>\n",
       "      <td>20.714920</td>\n",
       "      <td>22.612095</td>\n",
       "      <td>4.010857</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>388</th>\n",
       "      <th>standard</th>\n",
       "      <td>24.696079</td>\n",
       "      <td>-4.259727</td>\n",
       "      <td>0.098336</td>\n",
       "      <td>-2.500594</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>389</th>\n",
       "      <th>standard</th>\n",
       "      <td>27.578432</td>\n",
       "      <td>11.336646</td>\n",
       "      <td>14.499387</td>\n",
       "      <td>6.349677</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>390</th>\n",
       "      <th>standard</th>\n",
       "      <td>36.323528</td>\n",
       "      <td>-0.446557</td>\n",
       "      <td>3.442656</td>\n",
       "      <td>-0.209578</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>391</th>\n",
       "      <th>standard</th>\n",
       "      <td>11.490196</td>\n",
       "      <td>-12.447074</td>\n",
       "      <td>-6.483092</td>\n",
       "      <td>-2.429051</td>\n",
       "      <td>mna</td>\n",
       "      <td>300_500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                        MiPf       MiCe       MiPa      MiOc measure interval\n",
       "epoch_id stim                                                                \n",
       "387      standard  13.911765  20.714920  22.612095  4.010857     mna  300_500\n",
       "388      standard  24.696079  -4.259727   0.098336 -2.500594     mna  300_500\n",
       "389      standard  27.578432  11.336646  14.499387  6.349677     mna  300_500\n",
       "390      standard  36.323528  -0.446557   3.442656 -0.209578     mna  300_500\n",
       "391      standard  11.490196 -12.447074  -6.483092 -2.429051     mna  300_500"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# drop the no longer meaningful time_ms column\n",
    "mid_300_500_mna = mid_300_500_mna.drop(\"time_ms\", axis=1)\n",
    "\n",
    "# describe the type of measurment and interval\n",
    "mid_300_500_mna[\"measure\"] = \"mna\"\n",
    "mid_300_500_mna[\"interval\"] = \"300_500\"\n",
    "\n",
    "display(mid_300_500_mna.head(), mid_300_500_mna.tail())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "6. (optional) Export the measurements data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "mid_300_500_mna.reset_index().to_feather(DATA_DIR / \"p3_mid_mna_300_500.feather\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "7. Chaining: All of the above, simplified by chaining. The results are verifiably identical."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "coi = [\"epoch_id\", \"time_ms\", \"stim\", \"MiPf\", \"MiCe\", \"MiPa\", \"MiOc\"]\n",
    "\n",
    "# slice-groupby-apply\n",
    "mid_300_500_mna_c  = (\n",
    "    epochs_df[coi]\n",
    "    .query(\"time_ms >= 300 and time_ms <= 500\")\n",
    "    .groupby([\"epoch_id\", \"stim\"])\n",
    "    .mean()\n",
    "    .drop(\"time_ms\", axis=1)\n",
    ")\n",
    "\n",
    "# describe the type of measurment and interval\n",
    "mid_300_500_mna_c[\"measure\"] = \"mna\"\n",
    "mid_300_500_mna_c[\"interval\"] = \"300_500\"\n",
    "\n",
    "# verify steps and chained agree\n",
    "assert all(mid_300_500_mna_c == mid_300_500_mna)\n",
    "\n",
    "# export\n",
    "mid_300_500_mna_c.reset_index().to_feather(DATA_DIR / \"p3_mid_mna_300_500.feather\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
